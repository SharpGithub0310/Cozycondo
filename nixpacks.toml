[phases.setup]
nixPkgs = ["nodejs_20", "npm-10_x"]

[phases.install]
cmds = ["npm install --omit=dev --no-audit --no-fund"]

[phases.build]
cmds = ["npm run build"]

[start]
cmd = "npm start"

[variables]
NEXT_TELEMETRY_DISABLED = "1"
NODE_ENV = "production"
HOSTNAME = "0.0.0.0"
PORT = "3000"
# Memory and performance optimizations
NODE_OPTIONS = "--max-old-space-size=512 --enable-source-maps=false"
SILENT_MODE = "true"
# Next.js optimizations
NEXT_OPTIMIZE_FONTS = "false"
NEXT_OPTIMIZE_IMAGES = "false"

# Health check configuration for Dokploy - ultra-fast endpoint
[healthcheck]
path = "/api/health/fast"
port = "$PORT"
interval = "15s"
timeout = "10s"
retries = 3
start_period = "60s"
